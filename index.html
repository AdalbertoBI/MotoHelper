<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff">
    <title>MotoHelper</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <h1>MotoHelper</h1>
        <div class="tabs">
            <button class="tablink active" onclick="openTab(event, 'Rotas')">Rotas</button>
            <button class="tablink" onclick="openTab(event, 'Frete')">Frete</button>
            <button class="tablink" onclick="openTab(event, 'Postos')">Postos</button>
            <button class="tablink" onclick="openTab(event, 'Gastos')">Gastos</button>
            <button class="tablink" onclick="openTab(event, 'SOS')">SOS</button>
        </div>

        <div id="Rotas" class="tabcontent active">
            <h2>Otimizar Rotas</h2>
            <label for="origem">Origem:</label>
            <input type="text" id="origem" data-id="origem" list="sugestoesOrigem" placeholder="Digite sua origem" class="form-control">
            <datalist id="sugestoesOrigem"></datalist>
            <div id="carregandoLocalizacao" style="display: none;">Carregando localização...</div>

            <div id="paradas"></div>
            <button id="btnAdicionarParada" class="btn btn-secondary">Adicionar Parada</button>

            <label for="destino">Destino:</label>
            <input type="text" id="destino" data-id="destino" list="sugestoesDestino" placeholder="Digite seu destino" class="form-control">
            <datalist id="sugestoesDestino"></datalist>

            <button onclick="calcularRota()" class="btn btn-primary">Buscar Rota</button>
            <div id="mapa" style="height: 400px; margin-top: 10px;"></div>
            <div id="resultadoRota"></div>
            <div id="botaoIniciarRota" style="display: none; margin-top: 10px;">
                <button onclick="iniciarRota()" class="btn btn-success">Iniciar Rota</button>
            </div>
            <div id="instrucoesRota"></div>
        </div>

        <div id="Frete" class="tabcontent">
            <h2>Calcular Frete</h2>
            <label for="km">Distância (km):</label>
            <input type="number" id="km" class="form-control" placeholder="Digite a distância">
            <label for="peso">Peso (kg):</label>
            <input type="number" id="peso" class="form-control" placeholder="Digite o peso">
            <button onclick="calcularFrete()" class="btn btn-primary">Calcular</button>
            <p id="resultadoFrete"></p>
        </div>

        <div id="Postos" class="tabcontent">
            <h2>Postos Próximos</h2>
            <button onclick="buscarPostos()" class="btn btn-primary">Buscar Postos</button>
            <div id="mapaPostos" style="height: 400px; margin-top: 10px;"></div>
            <ul id="listaPostos"></ul>
        </div>

        <div id="Gastos" class="tabcontent">
            <h2>Gerenciar Gastos</h2>
            <label for="kmPorLitro">Km por Litro:</label>
            <input type="number" id="kmPorLitro" class="form-control" placeholder="Digite km/litro">
            <button onclick="salvarKmPorLitro()" class="btn btn-primary">Salvar</button>

            <label for="precoPorLitro">Preço por Litro (R$/litro):</label>
            <input type="number" id="precoPorLitro" class="form-control" placeholder="Digite o preço por litro">
            <button onclick="salvarPrecoPorLitro()" class="btn btn-primary">Salvar</button>

            <h3>Adicionar Gasto</h3>
            <label for="tipoGasto">Tipo:</label>
            <input type="text" id="tipoGasto" class="form-control" placeholder="Ex.: Combustível">
            <label for="valorGasto">Valor (R$):</label>
            <input type="number" id="valorGasto" class="form-control" placeholder="Digite o valor">
            <button onclick="salvarGasto()" class="btn btn-primary">Adicionar</button>
            <h3>Total: R$<span id="totalGastos">0.00</span></h3>
            <ul id="listaGastos"></ul>
        </div>

        <div id="SOS" class="tabcontent">
            <h2>Emergência</h2>
            <button onclick="enviarSOS()" class="btn btn-danger">Enviar SOS</button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="mapa.js"></script>
    <script src="script.js"></script>
    <script>
        function openTab(evt, tabName) {
            document.querySelectorAll('.tabcontent').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tablink').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }
    </script>
</body>
</html>