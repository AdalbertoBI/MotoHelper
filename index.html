<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#ffffff"> <title>MotoHelper</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin=""/>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
</head>
<body>
    <div class="container">
        <h1>MotoHelper</h1>
        <div class="tabs">
            <button class="tablink active" onclick="openTab(event, 'Rotas')">Rotas</button>
            <button class="tablink" onclick="openTab(event, 'Frete')">Frete</button>
            <button class="tablink" onclick="openTab(event, 'Postos')">Postos</button>
            <button class="tablink" onclick="openTab(event, 'Gastos')">Gastos</button>
            <button class="tablink" onclick="openTab(event, 'SOS')">SOS</button>
        </div>

        <div id="Rotas" class="tabcontent active">
            <h2>Otimizar Rotas</h2>
            <form id="formRota"> <div class="form-group">
                    <label for="origem">Origem:</label>
                    <input type="text" id="origem" data-id="origem" list="sugestoesOrigem" placeholder="Digite sua origem ou 'Localização Atual'" class="form-control">
                    <datalist id="sugestoesOrigem"></datalist>
                    <div id="carregandoLocalizacao" class="form-text text-muted" style="display: none;">Obtendo localização atual...</div>
                    <div id="buscandoSugestoes" class="form-text text-primary" style="display: none;">Buscando sugestões...</div>
                </div>

                <div id="paradas" class="form-group">
                    </div>
                <button type="button" id="btnAdicionarParada" class="btn btn-secondary mb-2">Adicionar Parada</button>

                <div class="form-group">
                    <label for="destino">Destino:</label>
                    <input type="text" id="destino" data-id="destino" list="sugestoesDestino" placeholder="Digite seu destino" class="form-control">
                    <datalist id="sugestoesDestino"></datalist>
                </div>

                <button type="button" id="btnCalcularRota" class="btn btn-primary">Buscar Rota</button>
             </form> <div id="map" style="height: 400px; width: 100%; margin-top: 15px; margin-bottom: 15px; border: 1px solid #ccc;">
                 <p style="padding: 10px; color: #666;">Carregando mapa...</p>
            </div>

            <div id="resultadoRota" class="mt-3">
                </div>

            <div id="botaoIniciarRota" style="display: none; margin-top: 15px;">
                <button type="button" id="btnGo" class="btn btn-success">Iniciar Rota (Maps/Waze)</button> </div>
        </div>

        <div id="Frete" class="tabcontent">
            <h2>Calcular Frete</h2>
            <div class="form-group">
                <label for="km">Distância (km):</label>
                <input type="number" id="km" class="form-control" placeholder="Digite a distância" min="0" step="0.1">
            </div>
            <div class="form-group">
                <label for="peso">Peso (kg):</label>
                <input type="number" id="peso" class="form-control" placeholder="Digite o peso" min="0" step="0.1">
            </div>
            <button type="button" id="btnCalcularFrete" class="btn btn-primary">Calcular</button>
            <p id="resultadoFrete" class="mt-2">Valor do Frete: R$ 0.00</p>
        </div>

        <div id="Postos" class="tabcontent">
            <h2>Postos Próximos</h2>
            <p>Buscar postos de combustível próximos à sua localização atual (requer permissão).</p>
            <button type="button" id="btnBuscarPostos" class="btn btn-primary">Buscar Postos Próximos</button>
            <ul id="listaPostos" class="list-group mt-3">
                </ul>
        </div>

        <div id="Gastos" class="tabcontent">
            <h2>Gerenciar Gastos e Consumo</h2>
            <div class="config-section mb-3 p-3 border rounded">
                 <h4>Configurações de Consumo</h4>
                 <div class="form-group">
                     <label for="kmPorLitro">Consumo (Km por Litro):</label>
                     <input type="number" id="kmPorLitro" class="form-control" placeholder="Ex: 35.5" min="0" step="0.1">
                     <button type="button" id="btnSalvarKmPorLitro" class="btn btn-secondary btn-sm mt-1">Salvar Consumo</button>
                 </div>
                 <div class="form-group mt-2">
                     <label for="precoPorLitro">Preço do Combustível (R$/litro):</label>
                     <input type="number" id="precoPorLitro" class="form-control" placeholder="Ex: 5.89" min="0" step="0.01">
                     <button type="button" id="btnSalvarPrecoPorLitro" class="btn btn-secondary btn-sm mt-1">Salvar Preço</button>
                 </div>
            </div>

             <div class="gastos-section mt-3">
                 <h3>Adicionar Novo Gasto</h3>
                 <div class="form-group">
                     <label for="tipoGasto">Tipo de Gasto:</label>
                     <input type="text" id="tipoGasto" class="form-control" placeholder="Ex: Combustível, Manutenção, Lanche">
                 </div>
                 <div class="form-group">
                     <label for="valorGasto">Valor (R$):</label>
                     <input type="number" id="valorGasto" class="form-control" placeholder="Digite o valor" min="0" step="0.01">
                 </div>
                 <button type="button" id="btnSalvarGasto" class="btn btn-primary">Adicionar Gasto</button>

                 <h3 class="mt-4">Histórico de Gastos</h3>
                  <p><strong>Total Gasto: R$ <span id="totalGastos">0.00</span></strong></p>
                 <ul id="listaGastos" class="list-group list-group-flush">
                     </ul>
            </div>
        </div>

        <div id="SOS" class="tabcontent">
            <h2>Emergência SOS</h2>
            <p class="text-danger"><strong>Atenção:</strong> Este botão tentará obter sua localização e exibir um alerta simulado. Em uma aplicação real, ele enviaria sua localização para contatos de emergência.</p>
            <button type="button" id="btnSOS" class="btn btn-danger btn-lg">Enviar Alerta SOS</button>
        </div>
    </div> <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="mapa.js"></script> <script src="script.js"></script>

    <script>
        function openTab(evt, tabName) {
            // Esconde todo o conteúdo das abas
            document.querySelectorAll('.tabcontent').forEach(tab => {
                // tab.style.display = 'none'; // Oculta completamente
                 tab.classList.remove('active'); // Ou apenas remove a classe 'active'
            });
            // Remove a classe 'active' de todos os botões de aba
            document.querySelectorAll('.tablink').forEach(link => {
                link.classList.remove('active');
            });
            // Mostra o conteúdo da aba clicada e ativa o botão
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');

             // Se a aba "Postos" for aberta E o mapa existir, garante que o mapa seja redesenhado corretamente
             // Isso pode ser necessário se o mapa foi inicializado enquanto a div estava oculta
             if (tabName === 'Postos' && typeof map !== 'undefined' && map) {
                 setTimeout(() => map.invalidateSize(), 10); // Pequeno delay para garantir que a div está visível
             }
             // O mesmo pode ser útil para a aba Rotas se ela não for a inicial
              if (tabName === 'Rotas' && typeof map !== 'undefined' && map) {
                 setTimeout(() => map.invalidateSize(), 10);
             }
        }

         // Garante que a aba inicial (Rotas) esteja visível ao carregar
         // (O CSS deve definir .tabcontent { display: none; } e .tabcontent.active { display: block; } )
         document.addEventListener('DOMContentLoaded', () => {
             if(document.querySelector('.tablink.active')) {
                 document.querySelector('.tablink.active').click(); // Simula um clique na aba ativa inicial
             }
         });
    </script>
</body>
</html>